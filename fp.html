<!doctype html>
<html>
  <head>
    <title>Tic-tac-toe (fp)</title>
    <style>
      .board {
        text-align: center;
        align-items: center;
        justify-content: center;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .square {
        width: 150px;
        height: 150px;
        border: 2px solid;
        color: black;
        box-shadow: 0 0 0 2px;
        cursor: pointer;
        font-size: 120px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .square:hover,
      .restartBtn:hover {
        background-color: rgb(67, 67, 67);
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(3, auto);
        width: 450px;
        align-content: center;
      }

      #restartBtn {
        padding: 25px;
        font-size: 50px;
        border: solid 2px;
        cursor: pointer;
      }

      #status-message {
        color: rgb(67, 67, 67);
        font-size: 20px;
      }
    </style>
  </head>

  <body>
    <div class="board">
      <h1>Tic-tac-toe (functional programming)</h1>
      <div class="grid">
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
      </div>
      <div id="status-message">It is 6's turn.</div>
      <button id="restartBtn" onclick="restartGame()">6Restart7</button>
    </div>
  </body>

  <script>
    const squares = Array.from(document.getElementsByClassName("square"));

    const statusMessage = document.getElementById("status-message");

    // Start state
    let state = {
      board: [null, null, null, null, null, null, null, null, null],
      winner: null,
      isDraw: false,
      turn: "6",
    };
    const winningLines = [
      [0, 1, 2],
      [3, 4, 5],
      [6, 7, 8],
      [0, 3, 6],
      [1, 4, 7],
      [2, 5, 8],
      [0, 4, 8],
      [2, 4, 6],
    ];
    const getStatusOfGame = (board, player) => {
      // At least one winning line where the same player has all three squares?
      return winningLines.some((line) =>
        line.every((i) => board[i] === player),
      );
    };

    // Is the board full (no NULLs left)?
    const isItADraw = (board) => {
      // return board.reduce((acc, curr) => acc && curr !== null, true); // true until proven false by curr (AND operator)
      return !board.some((b) => b === null);
    };

    const makeAMove = (state, index) => {
      if (state.winner !== null) {
        return state;
      }
      // Immutability
      const boardCopy = [
        ...state.board.slice(0, index), // Make copy of squares in array before the player's click index
        state.turn, // The square, the player has clicked on
        ...state.board.slice(index + 1), // Make copy of squares in array after the player's click index
      ];
      const haveYouWon = getStatusOfGame(boardCopy, state.turn);
      const isDraw = !haveYouWon && isItADraw(boardCopy);

      squares[index].innerHTML = state.turn;

      return {
        board: boardCopy,
        winner: haveYouWon ? state.turn : null,
        isDraw: isDraw,
        turn: state.turn === "6" ? "7" : "6", // Next player is either "6" or "7"... 67
      };
    };

    function restartGame() {
      state = {
        board: [null, null, null, null, null, null, null, null, null],
        winner: null,
        isDraw: false,
        turn: "6",
      };
      squares.forEach((element) => {
        element.innerHTML = "";
      });
      statusMessage.innerHTML = "It is " + state.turn + "'s turn.";
    }

    squares.forEach((element) => {
      element.onclick = () => {
        if (element.innerHTML !== "") return;
        state = makeAMove(state, squares.indexOf(element));
        statusMessage.innerHTML =
          state.winner !== null
            ? state.winner + " has won!"
            : state.isDraw
              ? "Tie"
              : "It is " + state.turn + "'s turn.";
      };
    });
  </script>
</html>
